<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perfil Editável - Oris TV</title>
  <link rel="icon" href="logo.ico" />
  <style>
    :root {
      --primary: #0f0;
      --dark: #0a0a0a;
      --card: #151515;
      --text: #fff;
      --text-muted: #aaa;
      --purple: #6e00ff;
      --green: #00ff00;
      --red: #ff0033;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--dark);
      color: var(--text);
    }
    header {
      background-color: var(--purple);
      padding: 0.8rem 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.6);
    }
    header img.logo {
      height: 48px;
      width: auto;
    }
    main {
      max-width: 700px;
      margin: 80px auto 2rem;
      padding: 2rem;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 0 10px #0f05;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    h1 {
      color: var(--primary);
      margin-bottom: 1rem;
      text-align: center;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    label {
      font-weight: 600;
      color: var(--green);
    }
    input[type="text"], textarea {
      background: #222;
      border: 1px solid #444;
      border-radius: 8px;
      color: var(--text);
      padding: 0.6rem 1rem;
      font-size: 1rem;
      resize: vertical;
    }
    textarea {
      min-height: 80px;
    }
    .photo-preview {
      margin-top: 0.5rem;
      text-align: center;
    }
    .photo-preview img {
      max-width: 150px;
      border-radius: 50%;
      border: 3px solid var(--green);
      object-fit: cover;
    }
    button {
      background: var(--green);
      color: var(--dark);
      border: none;
      font-weight: bold;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      align-self: center;
      width: 160px;
    }
    button:hover {
      background: #0c0;
      color: #fff;
    }
    .saved-message {
      text-align: center;
      margin-top: 1rem;
      color: var(--primary);
      font-weight: bold;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <img src="z.png" alt="Logo Oris TV" class="logo" />
  </header>

  <main>
    <h1>Editar Perfil</h1>

    <form id="profileForm">
      <label for="photo">URL da Foto do Perfil</label>
      <input type="text" id="photo" name="photo" placeholder="https://exemplo.com/foto.jpg" />
      <div class="photo-preview" id="photoPreview">
        <p>Preview da foto aparecerá aqui</p>
      </div>

      <label for="name">Nome Completo</label>
      <input type="text" id="name" name="name" placeholder="Seu nome completo" required />

      <label for="bio">Descrição / Bio</label>
      <textarea id="bio" name="bio" placeholder="Fale um pouco sobre você..."></textarea>

      <button type="submit">Salvar Perfil</button>
    </form>
    <div class="saved-message" id="savedMessage">Perfil salvo com sucesso! ✅</div>
  </main>

  <script>
    const photoInput = document.getElementById('photo');
    const nameInput = document.getElementById('name');
    const bioInput = document.getElementById('bio');
    const photoPreview = document.getElementById('photoPreview');
    const savedMessage = document.getElementById('savedMessage');
    const form = document.getElementById('profileForm');

    function updatePhotoPreview(url) {
      if (url.trim() === '') {
        photoPreview.innerHTML = '<p>Preview da foto aparecerá aqui</p>';
        return;
      }
      const img = document.createElement('img');
      img.src = url;
      img.alt = 'Foto do perfil';
      img.onerror = () => {
        photoPreview.innerHTML = '<p>URL inválida ou imagem não carregou</p>';
      };
      img.onload = () => {
        photoPreview.innerHTML = '';
        photoPreview.appendChild(img);
      };
      photoPreview.innerHTML = '';
      photoPreview.appendChild(img);
    }

    photoInput.addEventListener('input', () => {
      updatePhotoPreview(photoInput.value);
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      localStorage.setItem('profilePhoto', photoInput.value.trim());
      localStorage.setItem('profileName', nameInput.value.trim());
      localStorage.setItem('profileBio', bioInput.value.trim());

      savedMessage.style.display = 'block';
      setTimeout(() => {
        savedMessage.style.display = 'none';
      }, 3000);
    });

    // Carrega dados do localStorage ao abrir a página
    function loadProfile() {
      const photo = localStorage.getItem('profilePhoto') || '';
      const name = localStorage.getItem('profileName') || '';
      const bio = localStorage.getItem('profileBio') || '';

      photoInput.value = photo;
      nameInput.value = name;
      bioInput.value = bio;
      updatePhotoPreview(photo);
    }

    loadProfile();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perfil Editável - Oris TV</title>
  <link rel="icon" href="logo.ico" />
  <style>
    :root {
      --primary: #0f0;
      --dark: #0a0a0a;
      --card: #151515;
      --text: #fff;
      --text-muted: #aaa;
      --purple: #6e00ff;
      --green: #00ff00;
      --red: #ff0033;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--dark);
      color: var(--text);
    }
    header {
      background-color: var(--purple);
      padding: 0.8rem 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.6);
    }
    header img.logo {
      height: 48px;
      width: auto;
    }
    main {
      max-width: 700px;
      margin: 80px auto 2rem;
      padding: 2rem;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 0 10px #0f05;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    h1 {
      color: var(--primary);
      margin-bottom: 1rem;
      text-align: center;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    label {
      font-weight: 600;
      color: var(--green);
    }
    input[type="text"], textarea {
      background: #222;
      border: 1px solid #444;
      border-radius: 8px;
      color: var(--text);
      padding: 0.6rem 1rem;
      font-size: 1rem;
      resize: vertical;
    }
    textarea {
      min-height: 80px;
    }
    .photo-preview {
      margin-top: 0.5rem;
      text-align: center;
    }
    .photo-preview img {
      max-width: 150px;
      border-radius: 50%;
      border: 3px solid var(--green);
      object-fit: cover;
    }
    button {
      background: var(--green);
      color: var(--dark);
      border: none;
      font-weight: bold;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      align-self: center;
      width: 160px;
    }
    button:hover {
      background: #0c0;
      color: #fff;
    }
    .saved-message {
      text-align: center;
      margin-top: 1rem;
      color: var(--primary);
      font-weight: bold;
      display: none;
    }
    .login-btn {
      background: #24292e;
      color: #fff;
      width: 200px;
    }
    .login-btn:hover {
      background: #333;
    }
  </style>
</head>
<body>
  <header>
    <img src="z.png" alt="Logo Oris TV" class="logo" />
  </header>

  <main>
    <h1>Editar Perfil</h1>

    <button id="loginGitHubBtn" class="login-btn">Login com GitHub</button>

    <form id="profileForm" style="display:none;">
      <label for="photo">URL da Foto do Perfil</label>
      <input type="text" id="photo" name="photo" placeholder="https://exemplo.com/foto.jpg" />
      <div class="photo-preview" id="photoPreview">
        <p>Preview da foto aparecerá aqui</p>
      </div>

      <label for="name">Nome Completo</label>
      <input type="text" id="name" name="name" placeholder="Seu nome completo" required />

      <label for="bio">Descrição / Bio</label>
      <textarea id="bio" name="bio" placeholder="Fale um pouco sobre você..."></textarea>

      <button type="submit">Salvar Perfil</button>
    </form>
    <div class="saved-message" id="savedMessage">Perfil salvo com sucesso! ✅</div>
  </main>

  <script>
    const CLIENT_ID = 'Iv23liPBo37qNrfX2gK';
    const REDIRECT_URI = window.location.origin + window.location.pathname; // Mesma página
    const SCOPE = 'read:user';

    const loginBtn = document.getElementById('loginGitHubBtn');
    const form = document.getElementById('profileForm');
    const photoInput = document.getElementById('photo');
    const nameInput = document.getElementById('name');
    const bioInput = document.getElementById('bio');
    const photoPreview = document.getElementById('photoPreview');
    const savedMessage = document.getElementById('savedMessage');

    function updatePhotoPreview(url) {
      if (url.trim() === '') {
        photoPreview.innerHTML = '<p>Preview da foto aparecerá aqui</p>';
        return;
      }
      const img = document.createElement('img');
      img.src = url;
      img.alt = 'Foto do perfil';
      img.onerror = () => {
        photoPreview.innerHTML = '<p>URL inválida ou imagem não carregou</p>';
      };
      img.onload = () => {
        photoPreview.innerHTML = '';
        photoPreview.appendChild(img);
      };
      photoPreview.innerHTML = '';
      photoPreview.appendChild(img);
    }

    photoInput.addEventListener('input', () => {
      updatePhotoPreview(photoInput.value);
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      localStorage.setItem('profilePhoto', photoInput.value.trim());
      localStorage.setItem('profileName', nameInput.value.trim());
      localStorage.setItem('profileBio', bioInput.value.trim());

      savedMessage.style.display = 'block';
      setTimeout(() => {
        savedMessage.style.display = 'none';
      }, 3000);
    });

    // Função para buscar query params da URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // Função para trocar código pelo token via backend
    // Como não tem backend aqui, vamos fazer uma chamada direta à API pública com o código (não recomendado para produção)
    // Para fins de demo, vamos simplificar pegando dados públicos do username

    async function fetchGitHubUser(username) {
      const res = await fetch(`https://api.github.com/users/${username}`);
      if (!res.ok) throw new Error('Usuário não encontrado');
      return await res.json();
    }

    // Pega o username do localStorage (se já logou antes)
    function loadProfileFromStorage() {
      const photo = localStorage.getItem('profilePhoto') || '';
      const name = localStorage.getItem('profileName') || '';
      const bio = localStorage.getItem('profileBio') || '';

      if (photo || name || bio) {
        photoInput.value = photo;
        nameInput.value = name;
        bioInput.value = bio;
        updatePhotoPreview(photo);
        form.style.display = 'flex';
        loginBtn.style.display = 'none';
      }
    }

    // Inicia fluxo de login GitHub (redirect para OAuth)
    loginBtn.addEventListener('click', () => {
      const githubAuthUrl = 
        `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}` +
        `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}` +
        `&scope=${encodeURIComponent(SCOPE)}` +
        `&allow_signup=true`;
      window.location.href = githubAuthUrl;
    });

    // Depois do redirect, vamos tentar pegar o "code" da URL
    async function handleOAuthRedirect() {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      if (!code) {
        loadProfileFromStorage();
        return;
      }
      
      // IMPORTANTE: troca do "code" por token precisa de backend — NÃO FAÇA direto no front!
      // Aqui só para demo, vamos pedir ao usuário o nome manualmente, porque não dá para trocar o code sem backend.
      alert('Login com GitHub completado. Para demo, por favor, digite seu nome de usuário GitHub para preencher o perfil.');

      const username = prompt('Digite seu username do GitHub');
      if (!username) {
        alert('Nome de usuário é obrigatório para preencher perfil.');
        loadProfileFromStorage();
        return;
      }

      try {
        const userData = await fetchGitHubUser(username);
        photoInput.value = userData.avatar_url || '';
        nameInput.value = userData.name || userData.login || '';
        bioInput.value = userData.bio || '';
        updatePhotoPreview(photoInput.value);

        form.style.display = 'flex';
        loginBtn.style.display = 'none';

        // Limpa o code da URL para evitar repetir o fluxo
        window.history.replaceState({}, document.title, REDIRECT_URI);

        // Salva automaticamente
        localStorage.setItem('profilePhoto', photoInput.value.trim());
        localStorage.setItem('profileName', nameInput.value.trim());
        localStorage.setItem('profileBio', bioInput.value.trim());

        alert('Perfil preenchido com dados do GitHub!');
      } catch (err) {
        alert('Erro ao buscar dados do GitHub: ' + err.message);
        loadProfileFromStorage();
      }
    }

    handleOAuthRedirect();
  </script>
</body>
</html>
